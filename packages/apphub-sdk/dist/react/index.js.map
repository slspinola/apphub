{"version":3,"sources":["../../src/react/index.ts"],"names":[],"mappings":"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","file":"index.js","sourcesContent":["// ============================================================================\r\n// APPHUB SDK - React Integration (Client-Side Utilities)\r\n// ============================================================================\r\n\r\n/**\r\n * Note: This module provides client-side utilities for React applications.\r\n * For full Next.js integration with server components, use @apphub/sdk/nextjs\r\n */\r\n\r\nimport type {\r\n  TenantContext,\r\n  Permission,\r\n  EntityRole,\r\n  AppHubUser,\r\n  AppHubEntity,\r\n} from '../types'\r\n\r\nexport type { TenantContext, Permission, EntityRole, AppHubUser, AppHubEntity }\r\n\r\n// ============================================================================\r\n// CONTEXT TYPE FOR REACT\r\n// ============================================================================\r\n\r\n/**\r\n * Client-side session data (subset of TenantContext safe for client)\r\n */\r\nexport interface ClientSession {\r\n  user: AppHubUser\r\n  entity: AppHubEntity\r\n  role: EntityRole\r\n  permissions: Permission[]\r\n  isImpersonated: boolean\r\n}\r\n\r\n// ============================================================================\r\n// PERMISSION CHECKING (CLIENT-SIDE)\r\n// ============================================================================\r\n\r\n/**\r\n * Check if user has a specific permission\r\n */\r\nexport function hasPermission(\r\n  session: ClientSession | null,\r\n  permission: Permission\r\n): boolean {\r\n  return session?.permissions?.includes(permission) ?? false\r\n}\r\n\r\n/**\r\n * Check if user has ALL specified permissions\r\n */\r\nexport function hasAllPermissions(\r\n  session: ClientSession | null,\r\n  permissions: Permission[]\r\n): boolean {\r\n  if (!session?.permissions) return false\r\n  return permissions.every(p => session.permissions.includes(p))\r\n}\r\n\r\n/**\r\n * Check if user has ANY of the specified permissions\r\n */\r\nexport function hasAnyPermission(\r\n  session: ClientSession | null,\r\n  permissions: Permission[]\r\n): boolean {\r\n  if (!session?.permissions) return false\r\n  return permissions.some(p => session.permissions.includes(p))\r\n}\r\n\r\n/**\r\n * Role hierarchy for comparison\r\n */\r\nconst ROLE_HIERARCHY: Record<EntityRole, number> = {\r\n  member: 1,\r\n  manager: 2,\r\n  admin: 3,\r\n  owner: 4,\r\n}\r\n\r\n/**\r\n * Check if user has at least the specified role level\r\n */\r\nexport function hasRole(\r\n  session: ClientSession | null,\r\n  minimumRole: EntityRole\r\n): boolean {\r\n  if (!session?.role) return false\r\n  const userLevel = ROLE_HIERARCHY[session.role] ?? 0\r\n  const requiredLevel = ROLE_HIERARCHY[minimumRole] ?? 0\r\n  return userLevel >= requiredLevel\r\n}\r\n\r\n/**\r\n * Check if user is entity owner\r\n */\r\nexport function isOwner(session: ClientSession | null): boolean {\r\n  return session?.role === 'owner'\r\n}\r\n\r\n/**\r\n * Check if user is admin or owner\r\n */\r\nexport function isAdmin(session: ClientSession | null): boolean {\r\n  return hasRole(session, 'admin')\r\n}\r\n\r\n/**\r\n * Check if user can perform action on resource\r\n */\r\nexport function canPerform(\r\n  session: ClientSession | null,\r\n  resource: string,\r\n  action: string\r\n): boolean {\r\n  return hasPermission(session, `${resource}:${action}`)\r\n}\r\n\r\n/**\r\n * Check if user can read resource\r\n */\r\nexport function canRead(session: ClientSession | null, resource: string): boolean {\r\n  return canPerform(session, resource, 'read')\r\n}\r\n\r\n/**\r\n * Check if user can write to resource\r\n */\r\nexport function canWrite(session: ClientSession | null, resource: string): boolean {\r\n  return canPerform(session, resource, 'write')\r\n}\r\n\r\n/**\r\n * Check if user can delete resource\r\n */\r\nexport function canDelete(session: ClientSession | null, resource: string): boolean {\r\n  return canPerform(session, resource, 'delete')\r\n}\r\n\r\n// ============================================================================\r\n// REACT COMPONENT HELPERS\r\n// ============================================================================\r\n\r\n/**\r\n * Props for permission-based conditional rendering\r\n */\r\nexport interface PermissionGateProps {\r\n  /** Required permission(s) */\r\n  permission?: Permission | Permission[]\r\n  /** If true, require ALL permissions (default: require ANY) */\r\n  requireAll?: boolean\r\n  /** Required minimum role */\r\n  role?: EntityRole\r\n  /** Current session */\r\n  session: ClientSession | null\r\n  /** Content to show if authorized */\r\n  children: React.ReactNode\r\n  /** Content to show if not authorized */\r\n  fallback?: React.ReactNode\r\n}\r\n\r\n/**\r\n * Check if user passes permission/role gate\r\n * Use this to implement your own PermissionGate component\r\n */\r\nexport function checkGateAccess(\r\n  session: ClientSession | null,\r\n  options: {\r\n    permission?: Permission | Permission[]\r\n    requireAll?: boolean\r\n    role?: EntityRole\r\n  }\r\n): boolean {\r\n  const { permission, requireAll, role } = options\r\n\r\n  // Check role if specified\r\n  if (role && !hasRole(session, role)) {\r\n    return false\r\n  }\r\n\r\n  // Check permission if specified\r\n  if (permission) {\r\n    const permissions = Array.isArray(permission) ? permission : [permission]\r\n    if (requireAll) {\r\n      if (!hasAllPermissions(session, permissions)) {\r\n        return false\r\n      }\r\n    } else {\r\n      if (!hasAnyPermission(session, permissions)) {\r\n        return false\r\n      }\r\n    }\r\n  }\r\n\r\n  return true\r\n}\r\n\r\n// ============================================================================\r\n// UTILITY TYPES\r\n// ============================================================================\r\n\r\n/**\r\n * Extract permissions for a specific resource\r\n */\r\nexport function getResourcePermissions(\r\n  session: ClientSession | null,\r\n  resource: string\r\n): Permission[] {\r\n  if (!session?.permissions) return []\r\n  return session.permissions.filter(p => p.startsWith(`${resource}:`))\r\n}\r\n\r\n/**\r\n * Get list of resources user has any permission for\r\n */\r\nexport function getAccessibleResources(session: ClientSession | null): string[] {\r\n  if (!session?.permissions) return []\r\n  const resources = new Set<string>()\r\n  for (const permission of session.permissions) {\r\n    const [resource] = permission.split(':')\r\n    resources.add(resource)\r\n  }\r\n  return Array.from(resources)\r\n}\r\n\r\n/**\r\n * Check if user has access to any resource\r\n */\r\nexport function hasAnyAccess(session: ClientSession | null): boolean {\r\n  return (session?.permissions?.length ?? 0) > 0\r\n}\r\n\r\n// ============================================================================\r\n// SESSION UTILITIES\r\n// ============================================================================\r\n\r\n/**\r\n * Convert NextAuth.js session to ClientSession\r\n */\r\nexport function toClientSession(session: {\r\n  user?: {\r\n    id?: string\r\n    name?: string | null\r\n    email?: string | null\r\n    image?: string | null\r\n    entityId?: string\r\n    entityName?: string\r\n    entitySlug?: string\r\n    role?: EntityRole\r\n    permissions?: Permission[]\r\n  }\r\n} | null): ClientSession | null {\r\n  if (!session?.user?.entityId) return null\r\n\r\n  const user = session.user\r\n  \r\n  return {\r\n    user: {\r\n      id: user.id ?? '',\r\n      email: user.email ?? '',\r\n      name: user.name ?? null,\r\n      image: user.image ?? null,\r\n    },\r\n    entity: {\r\n      id: user.entityId!, // Guaranteed by the check above\r\n      name: user.entityName ?? '',\r\n      slug: user.entitySlug ?? '',\r\n    },\r\n    role: user.role ?? 'member',\r\n    permissions: user.permissions ?? [],\r\n    isImpersonated: false,\r\n  }\r\n}\r\n\r\n// ============================================================================\r\n// UI STATE HELPERS\r\n// ============================================================================\r\n\r\n/**\r\n * Determine which navigation items to show based on permissions\r\n */\r\nexport interface NavItem {\r\n  id: string\r\n  label: string\r\n  href: string\r\n  permission?: Permission\r\n  role?: EntityRole\r\n  icon?: string\r\n}\r\n\r\nexport function filterNavItems(\r\n  items: NavItem[],\r\n  session: ClientSession | null\r\n): NavItem[] {\r\n  return items.filter(item => {\r\n    if (item.permission && !hasPermission(session, item.permission)) {\r\n      return false\r\n    }\r\n    if (item.role && !hasRole(session, item.role)) {\r\n      return false\r\n    }\r\n    return true\r\n  })\r\n}\r\n\r\n/**\r\n * Get user's display name or fallback\r\n */\r\nexport function getUserDisplayName(\r\n  session: ClientSession | null,\r\n  fallback = 'User'\r\n): string {\r\n  return session?.user?.name || session?.user?.email || fallback\r\n}\r\n\r\n/**\r\n * Get user's initials for avatar\r\n */\r\nexport function getUserInitials(session: ClientSession | null): string {\r\n  const name = session?.user?.name\r\n  if (name) {\r\n    const parts = name.split(' ')\r\n    if (parts.length >= 2) {\r\n      return `${parts[0][0]}${parts[parts.length - 1][0]}`.toUpperCase()\r\n    }\r\n    return name.slice(0, 2).toUpperCase()\r\n  }\r\n  const email = session?.user?.email\r\n  if (email) {\r\n    return email.slice(0, 2).toUpperCase()\r\n  }\r\n  return '??'\r\n}\r\n\r\n"]}