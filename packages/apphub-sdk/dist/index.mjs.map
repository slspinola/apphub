{"version":3,"sources":["../src/oauth.ts","../src/jwt.ts","../src/api.ts","../src/webhook.ts","../src/rbac.ts","../src/scope.ts","../src/index.ts"],"names":[],"mappings":"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","file":"index.mjs","sourcesContent":["// ============================================================================\r\n// APPHUB SDK - OAuth Module\r\n// ============================================================================\r\n\r\nimport type {\r\n  AppHubConfig,\r\n  AuthorizationParams,\r\n  TokenResponse,\r\n  OAuthError,\r\n} from './types'\r\n\r\n/**\r\n * Generate a cryptographically secure random string\r\n */\r\nfunction generateRandomString(length: number): string {\r\n  const array = new Uint8Array(length)\r\n  if (typeof crypto !== 'undefined' && crypto.getRandomValues) {\r\n    crypto.getRandomValues(array)\r\n  } else {\r\n    // Node.js fallback\r\n    // eslint-disable-next-line @typescript-eslint/no-require-imports\r\n    const nodeCrypto = require('crypto')\r\n    nodeCrypto.randomFillSync(array)\r\n  }\r\n  return Array.from(array, (byte) => byte.toString(16).padStart(2, '0')).join('')\r\n}\r\n\r\n/**\r\n * Generate base64url encoded string\r\n */\r\nfunction base64urlEncode(buffer: ArrayBuffer): string {\r\n  const bytes = new Uint8Array(buffer)\r\n  let binary = ''\r\n  for (let i = 0; i < bytes.byteLength; i++) {\r\n    binary += String.fromCharCode(bytes[i])\r\n  }\r\n  return btoa(binary)\r\n    .replace(/\\+/g, '-')\r\n    .replace(/\\//g, '_')\r\n    .replace(/=+$/, '')\r\n}\r\n\r\n/**\r\n * Generate SHA-256 hash\r\n */\r\nasync function sha256(plain: string): Promise<ArrayBuffer> {\r\n  if (typeof crypto !== 'undefined' && crypto.subtle) {\r\n    const encoder = new TextEncoder()\r\n    const data = encoder.encode(plain)\r\n    return crypto.subtle.digest('SHA-256', data)\r\n  } else {\r\n    // Node.js fallback\r\n    // eslint-disable-next-line @typescript-eslint/no-require-imports\r\n    const nodeCrypto = require('crypto')\r\n    const hash = nodeCrypto.createHash('sha256').update(plain).digest()\r\n    return hash.buffer.slice(hash.byteOffset, hash.byteOffset + hash.byteLength)\r\n  }\r\n}\r\n\r\n/**\r\n * OAuth client for AppHub authentication\r\n */\r\nexport class AppHubOAuth {\r\n  private config: AppHubConfig\r\n  private tokenEndpoint: string\r\n  private authorizationEndpoint: string\r\n  private userInfoEndpoint: string\r\n\r\n  constructor(config: AppHubConfig) {\r\n    this.config = config\r\n    const baseUrl = config.hubUrl.replace(/\\/$/, '')\r\n    this.authorizationEndpoint = `${baseUrl}/oauth/authorize`\r\n    this.tokenEndpoint = `${baseUrl}/oauth/token`\r\n    this.userInfoEndpoint = `${baseUrl}/oauth/userinfo`\r\n  }\r\n\r\n  /**\r\n   * Generate PKCE code verifier\r\n   */\r\n  generateCodeVerifier(): string {\r\n    return generateRandomString(32)\r\n  }\r\n\r\n  /**\r\n   * Generate PKCE code challenge from verifier\r\n   */\r\n  async generateCodeChallenge(verifier: string): Promise<string> {\r\n    const hashed = await sha256(verifier)\r\n    return base64urlEncode(hashed)\r\n  }\r\n\r\n  /**\r\n   * Generate a random state parameter for CSRF protection\r\n   */\r\n  generateState(): string {\r\n    return generateRandomString(16)\r\n  }\r\n\r\n  /**\r\n   * Create authorization URL with all required parameters\r\n   */\r\n  async createAuthorizationUrl(options?: {\r\n    state?: string\r\n    codeVerifier?: string\r\n    scopes?: string[]\r\n    redirectUri?: string\r\n  }): Promise<AuthorizationParams> {\r\n    const state = options?.state ?? this.generateState()\r\n    const codeVerifier = options?.codeVerifier ?? this.generateCodeVerifier()\r\n    const codeChallenge = await this.generateCodeChallenge(codeVerifier)\r\n    const scopes = options?.scopes ?? ['openid', 'profile', 'email', 'organization']\r\n    const redirectUri = options?.redirectUri ?? this.config.redirectUri\r\n\r\n    if (!redirectUri) {\r\n      throw new Error('Redirect URI is required. Provide it in config or options.')\r\n    }\r\n\r\n    const params = new URLSearchParams({\r\n      client_id: this.config.clientId,\r\n      redirect_uri: redirectUri,\r\n      response_type: 'code',\r\n      scope: scopes.join(' '),\r\n      state,\r\n      code_challenge: codeChallenge,\r\n      code_challenge_method: 'S256',\r\n    })\r\n\r\n    return {\r\n      state,\r\n      codeVerifier,\r\n      codeChallenge,\r\n      authorizationUrl: `${this.authorizationEndpoint}?${params.toString()}`,\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Exchange authorization code for tokens\r\n   */\r\n  async exchangeCode(\r\n    code: string,\r\n    codeVerifier: string,\r\n    redirectUri?: string\r\n  ): Promise<TokenResponse> {\r\n    const uri = redirectUri ?? this.config.redirectUri\r\n    if (!uri) {\r\n      throw new Error('Redirect URI is required')\r\n    }\r\n\r\n    const body = new URLSearchParams({\r\n      grant_type: 'authorization_code',\r\n      code,\r\n      redirect_uri: uri,\r\n      client_id: this.config.clientId,\r\n      client_secret: this.config.clientSecret,\r\n      code_verifier: codeVerifier,\r\n    })\r\n\r\n    const response = await fetch(this.tokenEndpoint, {\r\n      method: 'POST',\r\n      headers: {\r\n        'Content-Type': 'application/x-www-form-urlencoded',\r\n      },\r\n      body: body.toString(),\r\n    })\r\n\r\n    if (!response.ok) {\r\n      const error: OAuthError = await response.json()\r\n      throw new AppHubOAuthError(\r\n        error.error,\r\n        error.error_description ?? 'Token exchange failed'\r\n      )\r\n    }\r\n\r\n    return response.json()\r\n  }\r\n\r\n  /**\r\n   * Refresh access token using refresh token\r\n   */\r\n  async refreshToken(refreshToken: string): Promise<TokenResponse> {\r\n    const body = new URLSearchParams({\r\n      grant_type: 'refresh_token',\r\n      refresh_token: refreshToken,\r\n      client_id: this.config.clientId,\r\n      client_secret: this.config.clientSecret,\r\n    })\r\n\r\n    const response = await fetch(this.tokenEndpoint, {\r\n      method: 'POST',\r\n      headers: {\r\n        'Content-Type': 'application/x-www-form-urlencoded',\r\n      },\r\n      body: body.toString(),\r\n    })\r\n\r\n    if (!response.ok) {\r\n      const error: OAuthError = await response.json()\r\n      throw new AppHubOAuthError(\r\n        error.error,\r\n        error.error_description ?? 'Token refresh failed'\r\n      )\r\n    }\r\n\r\n    return response.json()\r\n  }\r\n\r\n  /**\r\n   * Fetch user info from AppHub\r\n   */\r\n  async getUserInfo(accessToken: string): Promise<Record<string, unknown>> {\r\n    const response = await fetch(this.userInfoEndpoint, {\r\n      headers: {\r\n        Authorization: `Bearer ${accessToken}`,\r\n      },\r\n    })\r\n\r\n    if (!response.ok) {\r\n      throw new AppHubOAuthError('user_info_error', 'Failed to fetch user info')\r\n    }\r\n\r\n    return response.json()\r\n  }\r\n\r\n  /**\r\n   * Revoke a token (access or refresh)\r\n   */\r\n  async revokeToken(token: string, tokenType: 'access_token' | 'refresh_token' = 'access_token'): Promise<void> {\r\n    const baseUrl = this.config.hubUrl.replace(/\\/$/, '')\r\n    const revokeEndpoint = `${baseUrl}/oauth/revoke`\r\n\r\n    const body = new URLSearchParams({\r\n      token,\r\n      token_type_hint: tokenType,\r\n      client_id: this.config.clientId,\r\n      client_secret: this.config.clientSecret,\r\n    })\r\n\r\n    const response = await fetch(revokeEndpoint, {\r\n      method: 'POST',\r\n      headers: {\r\n        'Content-Type': 'application/x-www-form-urlencoded',\r\n      },\r\n      body: body.toString(),\r\n    })\r\n\r\n    if (!response.ok) {\r\n      throw new AppHubOAuthError('revoke_error', 'Failed to revoke token')\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * OAuth-specific error class\r\n */\r\nexport class AppHubOAuthError extends Error {\r\n  code: string\r\n  \r\n  constructor(code: string, message: string) {\r\n    super(message)\r\n    this.name = 'AppHubOAuthError'\r\n    this.code = code\r\n  }\r\n}\r\n\r\n/**\r\n * Create an OAuth client instance\r\n */\r\nexport function createOAuthClient(config: AppHubConfig): AppHubOAuth {\r\n  return new AppHubOAuth(config)\r\n}\r\n\r\n","// ============================================================================\r\n// APPHUB SDK - JWT Token Validation Module\r\n// ============================================================================\r\n\r\nimport * as jose from 'jose'\r\nimport type {\r\n  AppHubConfig,\r\n  AppHubTokenPayload,\r\n  TenantContext,\r\n  AppHubUser,\r\n  AppHubEntity,\r\n} from './types'\r\n\r\n/**\r\n * JWT validation options\r\n */\r\nexport interface JWTValidationOptions {\r\n  /** Skip audience validation */\r\n  skipAudienceCheck?: boolean\r\n  /** Skip license check */\r\n  skipLicenseCheck?: boolean\r\n  /** Additional required claims */\r\n  requiredClaims?: string[]\r\n}\r\n\r\n/**\r\n * JWT validation result\r\n */\r\nexport interface JWTValidationResult {\r\n  valid: boolean\r\n  payload?: AppHubTokenPayload\r\n  error?: string\r\n}\r\n\r\n/**\r\n * JWT Validator for AppHub tokens\r\n */\r\nexport class AppHubJWT {\r\n  private config: AppHubConfig\r\n  private publicKey: jose.KeyLike | null = null\r\n  private jwksUrl: string\r\n\r\n  constructor(config: AppHubConfig) {\r\n    this.config = config\r\n    const baseUrl = config.hubUrl.replace(/\\/$/, '')\r\n    this.jwksUrl = `${baseUrl}/.well-known/jwks.json`\r\n  }\r\n\r\n  /**\r\n   * Initialize the validator with the public key\r\n   * Call this once at startup for better performance\r\n   */\r\n  async initialize(): Promise<void> {\r\n    if (this.config.publicKey) {\r\n      this.publicKey = await jose.importSPKI(this.config.publicKey, 'RS256')\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get the public key for JWT verification\r\n   */\r\n  private async getPublicKey(): Promise<jose.KeyLike | Uint8Array | ReturnType<typeof jose.createRemoteJWKSet>> {\r\n    if (this.publicKey) {\r\n      return this.publicKey\r\n    }\r\n\r\n    if (this.config.publicKey) {\r\n      this.publicKey = await jose.importSPKI(this.config.publicKey, 'RS256')\r\n      return this.publicKey\r\n    }\r\n\r\n    // Fetch from JWKS endpoint - returns a function that fetches keys\r\n    return jose.createRemoteJWKSet(new URL(this.jwksUrl))\r\n  }\r\n\r\n  /**\r\n   * Validate a JWT access token\r\n   */\r\n  async validateToken(\r\n    token: string,\r\n    options: JWTValidationOptions = {}\r\n  ): Promise<JWTValidationResult> {\r\n    try {\r\n      const key = await this.getPublicKey() as Parameters<typeof jose.jwtVerify>[1]\r\n      \r\n      const verifyOptions: jose.JWTVerifyOptions = {\r\n        issuer: this.config.hubUrl.replace(/\\/$/, ''),\r\n        algorithms: ['RS256'],\r\n      }\r\n\r\n      // Add audience check unless skipped\r\n      if (!options.skipAudienceCheck) {\r\n        verifyOptions.audience = this.config.appSlug\r\n      }\r\n\r\n      const { payload } = await jose.jwtVerify(token, key, verifyOptions)\r\n\r\n      const tokenPayload = payload as unknown as AppHubTokenPayload\r\n\r\n      // Check license unless skipped\r\n      if (!options.skipLicenseCheck) {\r\n        if (!tokenPayload.licensed_apps?.includes(this.config.appSlug)) {\r\n          return {\r\n            valid: false,\r\n            error: `Entity is not licensed for app: ${this.config.appSlug}`,\r\n          }\r\n        }\r\n      }\r\n\r\n      // Check additional required claims\r\n      if (options.requiredClaims) {\r\n        for (const claim of options.requiredClaims) {\r\n          if (!(claim in tokenPayload)) {\r\n            return {\r\n              valid: false,\r\n              error: `Missing required claim: ${claim}`,\r\n            }\r\n          }\r\n        }\r\n      }\r\n\r\n      return {\r\n        valid: true,\r\n        payload: tokenPayload,\r\n      }\r\n    } catch (error) {\r\n      if (error instanceof jose.errors.JWTExpired) {\r\n        return { valid: false, error: 'Token has expired' }\r\n      }\r\n      if (error instanceof jose.errors.JWTClaimValidationFailed) {\r\n        return { valid: false, error: `Claim validation failed: ${error.message}` }\r\n      }\r\n      if (error instanceof jose.errors.JWSSignatureVerificationFailed) {\r\n        return { valid: false, error: 'Invalid token signature' }\r\n      }\r\n      return {\r\n        valid: false,\r\n        error: error instanceof Error ? error.message : 'Token validation failed',\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Validate and extract tenant context from token\r\n   */\r\n  async getTenantContext(\r\n    token: string,\r\n    options: JWTValidationOptions = {}\r\n  ): Promise<TenantContext> {\r\n    const result = await this.validateToken(token, options)\r\n\r\n    if (!result.valid || !result.payload) {\r\n      throw new AppHubJWTError('invalid_token', result.error ?? 'Invalid token')\r\n    }\r\n\r\n    const payload = result.payload\r\n\r\n    const user: AppHubUser = {\r\n      id: payload.sub,\r\n      email: payload.email,\r\n      name: payload.name,\r\n      image: payload.image ?? null,\r\n    }\r\n\r\n    const entity: AppHubEntity = {\r\n      id: payload.entity_id,\r\n      name: payload.entity_name,\r\n      slug: payload.entity_slug,\r\n    }\r\n\r\n    const scope = payload.scopes?.[this.config.appSlug] ?? null\r\n\r\n    return {\r\n      user,\r\n      entity,\r\n      role: payload.role,\r\n      permissions: payload.permissions ?? [],\r\n      scope,\r\n      isImpersonated: !!payload.impersonated_by,\r\n      impersonatedBy: payload.impersonated_by,\r\n      licensedApps: payload.licensed_apps ?? [],\r\n      tokenPayload: payload,\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Decode a token without verification (for debugging)\r\n   * WARNING: Never trust unverified tokens for authorization\r\n   */\r\n  decodeToken(token: string): AppHubTokenPayload | null {\r\n    try {\r\n      const decoded = jose.decodeJwt(token)\r\n      return decoded as unknown as AppHubTokenPayload\r\n    } catch {\r\n      return null\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Check if a token is expired (without full validation)\r\n   */\r\n  isTokenExpired(token: string): boolean {\r\n    const decoded = this.decodeToken(token)\r\n    if (!decoded?.exp) return true\r\n    return Date.now() >= decoded.exp * 1000\r\n  }\r\n\r\n  /**\r\n   * Get time until token expires in seconds\r\n   * Returns negative value if already expired\r\n   */\r\n  getTokenExpiresIn(token: string): number {\r\n    const decoded = this.decodeToken(token)\r\n    if (!decoded?.exp) return -1\r\n    return Math.floor(decoded.exp - Date.now() / 1000)\r\n  }\r\n}\r\n\r\n/**\r\n * JWT-specific error class\r\n */\r\nexport class AppHubJWTError extends Error {\r\n  code: string\r\n  \r\n  constructor(code: string, message: string) {\r\n    super(message)\r\n    this.name = 'AppHubJWTError'\r\n    this.code = code\r\n  }\r\n}\r\n\r\n/**\r\n * Create a JWT validator instance\r\n */\r\nexport function createJWTValidator(config: AppHubConfig): AppHubJWT {\r\n  return new AppHubJWT(config)\r\n}\r\n\r\n/**\r\n * Extract bearer token from Authorization header\r\n */\r\nexport function extractBearerToken(authHeader: string | null | undefined): string | null {\r\n  if (!authHeader) return null\r\n  const parts = authHeader.split(' ')\r\n  if (parts.length !== 2 || parts[0].toLowerCase() !== 'bearer') {\r\n    return null\r\n  }\r\n  return parts[1]\r\n}\r\n\r\n/**\r\n * Extract bearer token from request\r\n * Works with both Request and IncomingMessage-like objects\r\n */\r\nexport function extractTokenFromRequest(\r\n  req: { headers: Headers | Record<string, string | string[] | undefined> }\r\n): string | null {\r\n  let authHeader: string | null = null\r\n  \r\n  if (req.headers instanceof Headers) {\r\n    authHeader = req.headers.get('authorization')\r\n  } else {\r\n    const header = req.headers['authorization'] ?? req.headers['Authorization']\r\n    authHeader = Array.isArray(header) ? header[0] : header ?? null\r\n  }\r\n  \r\n  return extractBearerToken(authHeader)\r\n}\r\n\r\n","// ============================================================================\r\n// APPHUB SDK - API Client Module\r\n// ============================================================================\r\n\r\nimport type {\r\n  AppHubConfig,\r\n  PermissionDefinition,\r\n  ScopeTypeDefinition,\r\n  ApiResponse,\r\n  ApiError,\r\n  App,\r\n  Plan,\r\n  License,\r\n  ScopeOption,\r\n} from './types'\r\n\r\n/**\r\n * API client for communicating with AppHub\r\n */\r\nexport class AppHubApiClient {\r\n  private config: AppHubConfig\r\n  private baseUrl: string\r\n  private serviceToken: string | null = null\r\n\r\n  constructor(config: AppHubConfig) {\r\n    this.config = config\r\n    this.baseUrl = `${config.hubUrl.replace(/\\/$/, '')}/api/v1`\r\n  }\r\n\r\n  /**\r\n   * Set the service token for server-to-server API calls\r\n   */\r\n  setServiceToken(token: string): void {\r\n    this.serviceToken = token\r\n  }\r\n\r\n  /**\r\n   * Make an authenticated API request\r\n   */\r\n  private async request<T>(\r\n    method: string,\r\n    path: string,\r\n    options?: {\r\n      body?: unknown\r\n      token?: string\r\n      headers?: Record<string, string>\r\n    }\r\n  ): Promise<T> {\r\n    const url = `${this.baseUrl}${path}`\r\n    const token = options?.token ?? this.serviceToken\r\n\r\n    const headers: Record<string, string> = {\r\n      'Content-Type': 'application/json',\r\n      'X-App-ID': this.config.appSlug,\r\n      ...options?.headers,\r\n    }\r\n\r\n    if (token) {\r\n      headers['Authorization'] = `Bearer ${token}`\r\n    }\r\n\r\n    const response = await fetch(url, {\r\n      method,\r\n      headers,\r\n      body: options?.body ? JSON.stringify(options.body) : undefined,\r\n    })\r\n\r\n    if (!response.ok) {\r\n      const error = await response.json().catch(() => ({\r\n        error: 'unknown_error',\r\n        message: 'Request failed',\r\n        statusCode: response.status,\r\n      }))\r\n      throw new AppHubApiError(\r\n        error.error ?? 'api_error',\r\n        error.message ?? 'API request failed',\r\n        response.status,\r\n        error.details\r\n      )\r\n    }\r\n\r\n    return response.json()\r\n  }\r\n\r\n  // ============================================================================\r\n  // APP INFORMATION\r\n  // ============================================================================\r\n\r\n  /**\r\n   * Get current app information\r\n   */\r\n  async getApp(token?: string): Promise<App> {\r\n    const response = await this.request<ApiResponse<App>>(\r\n      'GET',\r\n      `/apps/${this.config.appSlug}`,\r\n      { token }\r\n    )\r\n    return response.data\r\n  }\r\n\r\n  // ============================================================================\r\n  // PERMISSIONS\r\n  // ============================================================================\r\n\r\n  /**\r\n   * Sync permissions with AppHub\r\n   * This registers or updates all permissions for your app\r\n   */\r\n  async syncPermissions(\r\n    permissions: PermissionDefinition[],\r\n    token?: string\r\n  ): Promise<{ created: number; updated: number; deleted: number; total: number }> {\r\n    const response = await this.request<ApiResponse<{\r\n      created: number\r\n      updated: number\r\n      deleted: number\r\n      total: number\r\n    }>>(\r\n      'POST',\r\n      `/apps/${this.config.appSlug}/permissions/sync`,\r\n      {\r\n        body: { permissions },\r\n        token,\r\n      }\r\n    )\r\n    return response.data\r\n  }\r\n\r\n  /**\r\n   * Get current permissions registered for the app\r\n   */\r\n  async getPermissions(token?: string): Promise<PermissionDefinition[]> {\r\n    const response = await this.request<ApiResponse<PermissionDefinition[]>>(\r\n      'GET',\r\n      `/apps/${this.config.appSlug}/permissions`,\r\n      { token }\r\n    )\r\n    return response.data\r\n  }\r\n\r\n  // ============================================================================\r\n  // SCOPE TYPES\r\n  // ============================================================================\r\n\r\n  /**\r\n   * Sync scope types with AppHub\r\n   */\r\n  async syncScopeTypes(\r\n    scopeTypes: ScopeTypeDefinition[],\r\n    token?: string\r\n  ): Promise<{ created: number; updated: number; deleted: number; total: number }> {\r\n    const response = await this.request<ApiResponse<{\r\n      created: number\r\n      updated: number\r\n      deleted: number\r\n      total: number\r\n    }>>(\r\n      'POST',\r\n      `/apps/${this.config.appSlug}/scope-types/sync`,\r\n      {\r\n        body: { scopeTypes },\r\n        token,\r\n      }\r\n    )\r\n    return response.data\r\n  }\r\n\r\n  /**\r\n   * Get current scope types registered for the app\r\n   */\r\n  async getScopeTypes(token?: string): Promise<ScopeTypeDefinition[]> {\r\n    const response = await this.request<ApiResponse<ScopeTypeDefinition[]>>(\r\n      'GET',\r\n      `/apps/${this.config.appSlug}/scope-types`,\r\n      { token }\r\n    )\r\n    return response.data\r\n  }\r\n\r\n  // ============================================================================\r\n  // PLANS & LICENSING\r\n  // ============================================================================\r\n\r\n  /**\r\n   * Get available plans for the app\r\n   */\r\n  async getPlans(token?: string): Promise<Plan[]> {\r\n    const response = await this.request<ApiResponse<Plan[]>>(\r\n      'GET',\r\n      `/apps/${this.config.appSlug}/plans`,\r\n      { token }\r\n    )\r\n    return response.data\r\n  }\r\n\r\n  /**\r\n   * Get license for a specific entity\r\n   */\r\n  async getLicense(entityId: string, token?: string): Promise<License | null> {\r\n    try {\r\n      const response = await this.request<ApiResponse<License>>(\r\n        'GET',\r\n        `/entities/${entityId}/licenses/${this.config.appSlug}`,\r\n        { token }\r\n      )\r\n      return response.data\r\n    } catch (error) {\r\n      if (error instanceof AppHubApiError && error.statusCode === 404) {\r\n        return null\r\n      }\r\n      throw error\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Check if an entity is licensed for this app\r\n   */\r\n  async isLicensed(entityId: string, token?: string): Promise<boolean> {\r\n    const license = await this.getLicense(entityId, token)\r\n    return license !== null && ['active', 'trial'].includes(license.status)\r\n  }\r\n\r\n  // ============================================================================\r\n  // SCOPE OPTIONS PROXY\r\n  // ============================================================================\r\n\r\n  /**\r\n   * Provide scope options for AppHub to display\r\n   * AppHub will call your optionsEndpoint and proxy through this\r\n   */\r\n  async getScopeOptions(\r\n    scopeType: string,\r\n    entityId: string,\r\n    token?: string\r\n  ): Promise<ScopeOption[]> {\r\n    const response = await this.request<ApiResponse<ScopeOption[]>>(\r\n      'GET',\r\n      `/apps/${this.config.appSlug}/scope-options/${scopeType}?entityId=${entityId}`,\r\n      { token }\r\n    )\r\n    return response.data\r\n  }\r\n\r\n  // ============================================================================\r\n  // ENTITY INFORMATION\r\n  // ============================================================================\r\n\r\n  /**\r\n   * Get entity information\r\n   */\r\n  async getEntity(entityId: string, token?: string): Promise<{\r\n    id: string\r\n    name: string\r\n    slug: string\r\n    logo?: string\r\n    parentId?: string\r\n  }> {\r\n    const response = await this.request<ApiResponse<{\r\n      id: string\r\n      name: string\r\n      slug: string\r\n      logo?: string\r\n      parentId?: string\r\n    }>>(\r\n      'GET',\r\n      `/entities/${entityId}`,\r\n      { token }\r\n    )\r\n    return response.data\r\n  }\r\n\r\n  /**\r\n   * Get entity members with their roles and permissions for this app\r\n   */\r\n  async getEntityMembers(\r\n    entityId: string,\r\n    token?: string\r\n  ): Promise<Array<{\r\n    userId: string\r\n    email: string\r\n    name: string\r\n    role: string\r\n    permissions: string[]\r\n    scope?: { type: string; value: unknown }\r\n  }>> {\r\n    const response = await this.request<ApiResponse<Array<{\r\n      userId: string\r\n      email: string\r\n      name: string\r\n      role: string\r\n      permissions: string[]\r\n      scope?: { type: string; value: unknown }\r\n    }>>>(\r\n      'GET',\r\n      `/entities/${entityId}/members?appId=${this.config.appSlug}`,\r\n      { token }\r\n    )\r\n    return response.data\r\n  }\r\n\r\n  // ============================================================================\r\n  // WEBHOOKS\r\n  // ============================================================================\r\n\r\n  /**\r\n   * Test webhook connectivity (sends a test event)\r\n   */\r\n  async testWebhook(webhookId: string, token?: string): Promise<{\r\n    success: boolean\r\n    statusCode: number\r\n    responseTime: number\r\n  }> {\r\n    const response = await this.request<ApiResponse<{\r\n      success: boolean\r\n      statusCode: number\r\n      responseTime: number\r\n    }>>(\r\n      'POST',\r\n      `/apps/${this.config.appSlug}/webhooks/${webhookId}/test`,\r\n      { token }\r\n    )\r\n    return response.data\r\n  }\r\n\r\n  // ============================================================================\r\n  // UTILITY METHODS\r\n  // ============================================================================\r\n\r\n  /**\r\n   * Health check for AppHub connectivity\r\n   */\r\n  async healthCheck(): Promise<boolean> {\r\n    try {\r\n      const response = await fetch(`${this.config.hubUrl}/health`)\r\n      return response.ok\r\n    } catch {\r\n      return false\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get AppHub public key for JWT verification\r\n   */\r\n  async getPublicKey(): Promise<string> {\r\n    const response = await fetch(`${this.baseUrl}/.well-known/jwks.json`)\r\n    if (!response.ok) {\r\n      throw new AppHubApiError('jwks_error', 'Failed to fetch JWKS', response.status)\r\n    }\r\n    const jwks = await response.json()\r\n    // Return the first key's public key\r\n    if (jwks.keys && jwks.keys.length > 0) {\r\n      return JSON.stringify(jwks.keys[0])\r\n    }\r\n    throw new AppHubApiError('jwks_error', 'No keys found in JWKS', 404)\r\n  }\r\n}\r\n\r\n/**\r\n * API-specific error class\r\n */\r\nexport class AppHubApiError extends Error {\r\n  code: string\r\n  statusCode: number\r\n  details?: Record<string, unknown>\r\n  \r\n  constructor(\r\n    code: string,\r\n    message: string,\r\n    statusCode: number,\r\n    details?: Record<string, unknown>\r\n  ) {\r\n    super(message)\r\n    this.name = 'AppHubApiError'\r\n    this.code = code\r\n    this.statusCode = statusCode\r\n    this.details = details\r\n  }\r\n\r\n  /**\r\n   * Check if error is a not found error\r\n   */\r\n  isNotFound(): boolean {\r\n    return this.statusCode === 404\r\n  }\r\n\r\n  /**\r\n   * Check if error is an authorization error\r\n   */\r\n  isUnauthorized(): boolean {\r\n    return this.statusCode === 401\r\n  }\r\n\r\n  /**\r\n   * Check if error is a forbidden error\r\n   */\r\n  isForbidden(): boolean {\r\n    return this.statusCode === 403\r\n  }\r\n}\r\n\r\n/**\r\n * Create an API client instance\r\n */\r\nexport function createApiClient(config: AppHubConfig): AppHubApiClient {\r\n  return new AppHubApiClient(config)\r\n}\r\n\r\n","// ============================================================================\r\n// APPHUB SDK - Webhook Handler Module\r\n// ============================================================================\r\n\r\nimport type {\r\n  WebhookEvent,\r\n  WebhookEventType,\r\n  UserEventData,\r\n  MembershipEventData,\r\n  LicenseEventData,\r\n} from './types'\r\n\r\n/**\r\n * Webhook handler function type\r\n */\r\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\r\nexport type WebhookHandler<T = any> = (\r\n  event: WebhookEvent<T>\r\n) => Promise<void> | void\r\n\r\n/**\r\n * Map of event types to their handlers\r\n */\r\nexport type WebhookHandlerMap = Partial<Record<WebhookEventType, WebhookHandler>>\r\n\r\n/**\r\n * HMAC signature utilities for webhook verification\r\n */\r\nasync function computeHmacSha256(payload: string, secret: string): Promise<string> {\r\n  if (typeof crypto !== 'undefined' && crypto.subtle) {\r\n    const encoder = new TextEncoder()\r\n    const key = await crypto.subtle.importKey(\r\n      'raw',\r\n      encoder.encode(secret),\r\n      { name: 'HMAC', hash: 'SHA-256' },\r\n      false,\r\n      ['sign']\r\n    )\r\n    const signature = await crypto.subtle.sign('HMAC', key, encoder.encode(payload))\r\n    return Array.from(new Uint8Array(signature))\r\n      .map((b) => b.toString(16).padStart(2, '0'))\r\n      .join('')\r\n  } else {\r\n    // Node.js fallback\r\n    // eslint-disable-next-line @typescript-eslint/no-require-imports\r\n    const nodeCrypto = require('crypto')\r\n    return nodeCrypto.createHmac('sha256', secret).update(payload).digest('hex')\r\n  }\r\n}\r\n\r\n/**\r\n * Timing-safe string comparison\r\n */\r\nfunction timingSafeEqual(a: string, b: string): boolean {\r\n  if (a.length !== b.length) return false\r\n  \r\n  let result = 0\r\n  for (let i = 0; i < a.length; i++) {\r\n    result |= a.charCodeAt(i) ^ b.charCodeAt(i)\r\n  }\r\n  return result === 0\r\n}\r\n\r\n/**\r\n * Verify webhook signature from AppHub\r\n */\r\nexport async function verifyWebhookSignature(\r\n  payload: string,\r\n  signature: string,\r\n  secret: string\r\n): Promise<boolean> {\r\n  const expectedSignature = await computeHmacSha256(payload, secret)\r\n  const providedSignature = signature.startsWith('sha256=')\r\n    ? signature.slice(7)\r\n    : signature\r\n  \r\n  return timingSafeEqual(expectedSignature, providedSignature)\r\n}\r\n\r\n/**\r\n * Parse and validate a webhook request\r\n */\r\nexport async function parseWebhookRequest<T = Record<string, unknown>>(\r\n  payload: string,\r\n  signature: string,\r\n  secret: string\r\n): Promise<WebhookEvent<T>> {\r\n  // Verify signature\r\n  const isValid = await verifyWebhookSignature(payload, signature, secret)\r\n  if (!isValid) {\r\n    throw new WebhookError('invalid_signature', 'Invalid webhook signature')\r\n  }\r\n\r\n  // Parse payload\r\n  try {\r\n    const event = JSON.parse(payload) as WebhookEvent<T>\r\n    \r\n    // Basic validation\r\n    if (!event.id || !event.type || !event.timestamp) {\r\n      throw new WebhookError('invalid_payload', 'Missing required event fields')\r\n    }\r\n    \r\n    return event\r\n  } catch (error) {\r\n    if (error instanceof WebhookError) throw error\r\n    throw new WebhookError('parse_error', 'Failed to parse webhook payload')\r\n  }\r\n}\r\n\r\n/**\r\n * Webhook error class\r\n */\r\nexport class WebhookError extends Error {\r\n  code: string\r\n  \r\n  constructor(code: string, message: string) {\r\n    super(message)\r\n    this.name = 'WebhookError'\r\n    this.code = code\r\n  }\r\n}\r\n\r\n/**\r\n * Webhook processor for handling multiple event types\r\n */\r\nexport class WebhookProcessor {\r\n  private secret: string\r\n  private handlers: WebhookHandlerMap = {}\r\n  private defaultHandler?: WebhookHandler\r\n\r\n  constructor(secret: string) {\r\n    this.secret = secret\r\n  }\r\n\r\n  /**\r\n   * Register a handler for a specific event type\r\n   */\r\n  on(eventType: WebhookEventType, handler: WebhookHandler): this {\r\n    this.handlers[eventType] = handler\r\n    return this\r\n  }\r\n\r\n  /**\r\n   * Register a default handler for unhandled events\r\n   */\r\n  onDefault(handler: WebhookHandler): this {\r\n    this.defaultHandler = handler\r\n    return this\r\n  }\r\n\r\n  /**\r\n   * Register handlers for user events\r\n   */\r\n  onUserCreated(handler: WebhookHandler<UserEventData>): this {\r\n    return this.on('user.created', handler)\r\n  }\r\n\r\n  onUserUpdated(handler: WebhookHandler<UserEventData>): this {\r\n    return this.on('user.updated', handler)\r\n  }\r\n\r\n  onUserDeleted(handler: WebhookHandler<UserEventData>): this {\r\n    return this.on('user.deleted', handler)\r\n  }\r\n\r\n  /**\r\n   * Register handlers for membership events\r\n   */\r\n  onMembershipCreated(handler: WebhookHandler<MembershipEventData>): this {\r\n    return this.on('membership.created', handler)\r\n  }\r\n\r\n  onMembershipUpdated(handler: WebhookHandler<MembershipEventData>): this {\r\n    return this.on('membership.updated', handler)\r\n  }\r\n\r\n  onMembershipDeleted(handler: WebhookHandler<MembershipEventData>): this {\r\n    return this.on('membership.deleted', handler)\r\n  }\r\n\r\n  /**\r\n   * Register handlers for license events\r\n   */\r\n  onLicenseActivated(handler: WebhookHandler<LicenseEventData>): this {\r\n    return this.on('license.activated', handler)\r\n  }\r\n\r\n  onLicenseSuspended(handler: WebhookHandler<LicenseEventData>): this {\r\n    return this.on('license.suspended', handler)\r\n  }\r\n\r\n  onLicenseCancelled(handler: WebhookHandler<LicenseEventData>): this {\r\n    return this.on('license.cancelled', handler)\r\n  }\r\n\r\n  /**\r\n   * Process a webhook request\r\n   */\r\n  async process(payload: string, signature: string): Promise<WebhookEvent> {\r\n    const event = await parseWebhookRequest(payload, signature, this.secret)\r\n    \r\n    const handler = this.handlers[event.type] ?? this.defaultHandler\r\n    if (handler) {\r\n      await handler(event)\r\n    }\r\n    \r\n    return event\r\n  }\r\n\r\n  /**\r\n   * Create a request handler for common frameworks\r\n   */\r\n  createHandler() {\r\n    return async (req: {\r\n      text?: () => Promise<string>\r\n      body?: string | Record<string, unknown>\r\n      headers: Headers | Record<string, string | string[] | undefined>\r\n    }): Promise<{ success: boolean; event?: WebhookEvent; error?: string }> => {\r\n      try {\r\n        // Get payload\r\n        let payload: string\r\n        if (typeof req.text === 'function') {\r\n          payload = await req.text()\r\n        } else if (typeof req.body === 'string') {\r\n          payload = req.body\r\n        } else if (req.body) {\r\n          payload = JSON.stringify(req.body)\r\n        } else {\r\n          throw new WebhookError('no_payload', 'No request body')\r\n        }\r\n\r\n        // Get signature\r\n        let signature: string | null = null\r\n        if (req.headers instanceof Headers) {\r\n          signature = req.headers.get('x-apphub-signature')\r\n        } else {\r\n          const header = req.headers['x-apphub-signature'] ?? req.headers['X-AppHub-Signature']\r\n          signature = Array.isArray(header) ? header[0] : header ?? null\r\n        }\r\n\r\n        if (!signature) {\r\n          throw new WebhookError('no_signature', 'Missing X-AppHub-Signature header')\r\n        }\r\n\r\n        const event = await this.process(payload, signature)\r\n        return { success: true, event }\r\n      } catch (error) {\r\n        return {\r\n          success: false,\r\n          error: error instanceof Error ? error.message : 'Unknown error',\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Create a webhook processor\r\n */\r\nexport function createWebhookProcessor(secret: string): WebhookProcessor {\r\n  return new WebhookProcessor(secret)\r\n}\r\n\r\n// ============================================================================\r\n// NEXT.JS WEBHOOK HANDLER HELPER\r\n// ============================================================================\r\n\r\n/**\r\n * Options for creating a Next.js webhook handler\r\n */\r\nexport interface NextJSWebhookOptions {\r\n  secret: string\r\n  handlers: WebhookHandlerMap\r\n  onError?: (error: Error) => void\r\n}\r\n\r\n/**\r\n * Create a Next.js API route handler for webhooks\r\n * For use in app/api/webhooks/apphub/route.ts\r\n */\r\nexport function createNextJSWebhookHandler(options: NextJSWebhookOptions) {\r\n  const processor = new WebhookProcessor(options.secret)\r\n  \r\n  // Register all handlers\r\n  for (const [eventType, handler] of Object.entries(options.handlers)) {\r\n    if (handler) {\r\n      processor.on(eventType as WebhookEventType, handler)\r\n    }\r\n  }\r\n\r\n  return async function POST(request: Request): Promise<Response> {\r\n    try {\r\n      const payload = await request.text()\r\n      const signature = request.headers.get('x-apphub-signature')\r\n\r\n      if (!signature) {\r\n        return Response.json(\r\n          { error: 'Missing signature' },\r\n          { status: 401 }\r\n        )\r\n      }\r\n\r\n      const event = await processor.process(payload, signature)\r\n      \r\n      return Response.json({ received: true, eventId: event.id })\r\n    } catch (error) {\r\n      if (options.onError && error instanceof Error) {\r\n        options.onError(error)\r\n      }\r\n\r\n      if (error instanceof WebhookError) {\r\n        if (error.code === 'invalid_signature') {\r\n          return Response.json({ error: error.message }, { status: 401 })\r\n        }\r\n        return Response.json({ error: error.message }, { status: 400 })\r\n      }\r\n\r\n      return Response.json({ error: 'Internal error' }, { status: 500 })\r\n    }\r\n  }\r\n}\r\n\r\n","// ============================================================================\r\n// APPHUB SDK - Role-Based Access Control (RBAC) Module\r\n// ============================================================================\r\n\r\nimport type {\r\n  TenantContext,\r\n  Permission,\r\n  EntityRole,\r\n  PermissionDefinition,\r\n} from './types'\r\n\r\n/**\r\n * Role hierarchy levels (higher number = more permissions)\r\n */\r\nconst ROLE_HIERARCHY: Record<EntityRole, number> = {\r\n  member: 1,\r\n  manager: 2,\r\n  admin: 3,\r\n  owner: 4,\r\n}\r\n\r\n/**\r\n * Check if a user has a specific permission\r\n */\r\nexport function hasPermission(\r\n  ctx: TenantContext,\r\n  permission: Permission\r\n): boolean {\r\n  return ctx.permissions.includes(permission)\r\n}\r\n\r\n/**\r\n * Check if a user has ALL of the specified permissions\r\n */\r\nexport function hasAllPermissions(\r\n  ctx: TenantContext,\r\n  permissions: Permission[]\r\n): boolean {\r\n  return permissions.every((p) => ctx.permissions.includes(p))\r\n}\r\n\r\n/**\r\n * Check if a user has ANY of the specified permissions\r\n */\r\nexport function hasAnyPermission(\r\n  ctx: TenantContext,\r\n  permissions: Permission[]\r\n): boolean {\r\n  return permissions.some((p) => ctx.permissions.includes(p))\r\n}\r\n\r\n/**\r\n * Check if a user has at least the specified role level\r\n */\r\nexport function hasRole(ctx: TenantContext, minimumRole: EntityRole): boolean {\r\n  const userLevel = ROLE_HIERARCHY[ctx.role] ?? 0\r\n  const requiredLevel = ROLE_HIERARCHY[minimumRole] ?? 0\r\n  return userLevel >= requiredLevel\r\n}\r\n\r\n/**\r\n * Check if user has exact role (no hierarchy)\r\n */\r\nexport function hasExactRole(ctx: TenantContext, role: EntityRole): boolean {\r\n  return ctx.role === role\r\n}\r\n\r\n/**\r\n * Check if user is entity owner\r\n */\r\nexport function isOwner(ctx: TenantContext): boolean {\r\n  return ctx.role === 'owner'\r\n}\r\n\r\n/**\r\n * Check if user is admin or owner\r\n */\r\nexport function isAdmin(ctx: TenantContext): boolean {\r\n  return hasRole(ctx, 'admin')\r\n}\r\n\r\n/**\r\n * Check if user is currently being impersonated\r\n */\r\nexport function isImpersonated(ctx: TenantContext): boolean {\r\n  return ctx.isImpersonated\r\n}\r\n\r\n/**\r\n * Parse a permission string into resource and action\r\n */\r\nexport function parsePermission(permission: Permission): {\r\n  resource: string\r\n  action: string\r\n} {\r\n  const parts = permission.split(':')\r\n  if (parts.length !== 2) {\r\n    throw new Error(`Invalid permission format: ${permission}`)\r\n  }\r\n  return {\r\n    resource: parts[0],\r\n    action: parts[1],\r\n  }\r\n}\r\n\r\n/**\r\n * Build a permission string from resource and action\r\n */\r\nexport function buildPermission(resource: string, action: string): Permission {\r\n  return `${resource}:${action}`\r\n}\r\n\r\n/**\r\n * Get all permissions for a specific resource\r\n */\r\nexport function getPermissionsForResource(\r\n  ctx: TenantContext,\r\n  resource: string\r\n): Permission[] {\r\n  return ctx.permissions.filter((p) => p.startsWith(`${resource}:`))\r\n}\r\n\r\n/**\r\n * Check if user can perform an action on a resource\r\n */\r\nexport function canPerform(\r\n  ctx: TenantContext,\r\n  resource: string,\r\n  action: string\r\n): boolean {\r\n  const permission = buildPermission(resource, action)\r\n  return hasPermission(ctx, permission)\r\n}\r\n\r\n/**\r\n * Check if user can read a resource\r\n */\r\nexport function canRead(ctx: TenantContext, resource: string): boolean {\r\n  return canPerform(ctx, resource, 'read')\r\n}\r\n\r\n/**\r\n * Check if user can write to a resource\r\n */\r\nexport function canWrite(ctx: TenantContext, resource: string): boolean {\r\n  return canPerform(ctx, resource, 'write')\r\n}\r\n\r\n/**\r\n * Check if user can delete a resource\r\n */\r\nexport function canDelete(ctx: TenantContext, resource: string): boolean {\r\n  return canPerform(ctx, resource, 'delete')\r\n}\r\n\r\n/**\r\n * Check if user can manage a resource (full control)\r\n */\r\nexport function canManage(ctx: TenantContext, resource: string): boolean {\r\n  return canPerform(ctx, resource, 'manage')\r\n}\r\n\r\n// ============================================================================\r\n// PERMISSION GUARD UTILITIES\r\n// ============================================================================\r\n\r\n/**\r\n * Authorization error for guard functions\r\n */\r\nexport class AuthorizationError extends Error {\r\n  code: string\r\n  requiredPermission?: Permission\r\n  requiredRole?: EntityRole\r\n  \r\n  constructor(\r\n    message: string,\r\n    options?: { permission?: Permission; role?: EntityRole }\r\n  ) {\r\n    super(message)\r\n    this.name = 'AuthorizationError'\r\n    this.code = 'unauthorized'\r\n    this.requiredPermission = options?.permission\r\n    this.requiredRole = options?.role\r\n  }\r\n}\r\n\r\n/**\r\n * Guard that throws if permission is missing\r\n */\r\nexport function requirePermission(\r\n  ctx: TenantContext,\r\n  permission: Permission\r\n): void {\r\n  if (!hasPermission(ctx, permission)) {\r\n    throw new AuthorizationError(\r\n      `Missing required permission: ${permission}`,\r\n      { permission }\r\n    )\r\n  }\r\n}\r\n\r\n/**\r\n * Guard that throws if any permission is missing\r\n */\r\nexport function requireAllPermissions(\r\n  ctx: TenantContext,\r\n  permissions: Permission[]\r\n): void {\r\n  const missing = permissions.filter((p) => !hasPermission(ctx, p))\r\n  if (missing.length > 0) {\r\n    throw new AuthorizationError(\r\n      `Missing required permissions: ${missing.join(', ')}`,\r\n      { permission: missing[0] }\r\n    )\r\n  }\r\n}\r\n\r\n/**\r\n * Guard that throws if user doesn't have at least one of the permissions\r\n */\r\nexport function requireAnyPermission(\r\n  ctx: TenantContext,\r\n  permissions: Permission[]\r\n): void {\r\n  if (!hasAnyPermission(ctx, permissions)) {\r\n    throw new AuthorizationError(\r\n      `Requires one of: ${permissions.join(', ')}`,\r\n      { permission: permissions[0] }\r\n    )\r\n  }\r\n}\r\n\r\n/**\r\n * Guard that throws if user doesn't have minimum role\r\n */\r\nexport function requireRole(ctx: TenantContext, minimumRole: EntityRole): void {\r\n  if (!hasRole(ctx, minimumRole)) {\r\n    throw new AuthorizationError(\r\n      `Requires role: ${minimumRole} or higher`,\r\n      { role: minimumRole }\r\n    )\r\n  }\r\n}\r\n\r\n/**\r\n * Guard that throws if user is not admin\r\n */\r\nexport function requireAdmin(ctx: TenantContext): void {\r\n  requireRole(ctx, 'admin')\r\n}\r\n\r\n/**\r\n * Guard that throws if user is not owner\r\n */\r\nexport function requireOwner(ctx: TenantContext): void {\r\n  requireRole(ctx, 'owner')\r\n}\r\n\r\n// ============================================================================\r\n// PERMISSION DEFINITION HELPERS\r\n// ============================================================================\r\n\r\n/**\r\n * Create a permission definition\r\n */\r\nexport function definePermission(\r\n  resource: string,\r\n  action: string,\r\n  options: Omit<PermissionDefinition, 'slug' | 'resource' | 'action'>\r\n): PermissionDefinition {\r\n  return {\r\n    slug: buildPermission(resource, action),\r\n    resource,\r\n    action,\r\n    ...options,\r\n  }\r\n}\r\n\r\n/**\r\n * Define a standard CRUD permission set for a resource\r\n */\r\nexport function defineCrudPermissions(\r\n  resource: string,\r\n  displayName: string,\r\n  options?: {\r\n    groupName?: string\r\n    defaultActions?: ('read' | 'write' | 'delete')[]\r\n    includeManage?: boolean\r\n    includeExport?: boolean\r\n  }\r\n): PermissionDefinition[] {\r\n  const groupName = options?.groupName ?? displayName\r\n  const defaultActions = options?.defaultActions ?? ['read']\r\n  \r\n  const permissions: PermissionDefinition[] = [\r\n    {\r\n      slug: `${resource}:read`,\r\n      name: `View ${displayName}`,\r\n      description: `View ${displayName.toLowerCase()} list and details`,\r\n      resource,\r\n      action: 'read',\r\n      groupName,\r\n      sortOrder: 0,\r\n      isDefault: defaultActions.includes('read'),\r\n    },\r\n    {\r\n      slug: `${resource}:write`,\r\n      name: `Edit ${displayName}`,\r\n      description: `Create and update ${displayName.toLowerCase()}`,\r\n      resource,\r\n      action: 'write',\r\n      groupName,\r\n      sortOrder: 1,\r\n      isDefault: defaultActions.includes('write'),\r\n    },\r\n    {\r\n      slug: `${resource}:delete`,\r\n      name: `Delete ${displayName}`,\r\n      description: `Delete ${displayName.toLowerCase()}`,\r\n      resource,\r\n      action: 'delete',\r\n      groupName,\r\n      sortOrder: 2,\r\n      isDefault: defaultActions.includes('delete'),\r\n    },\r\n  ]\r\n\r\n  if (options?.includeManage) {\r\n    permissions.push({\r\n      slug: `${resource}:manage`,\r\n      name: `Manage ${displayName}`,\r\n      description: `Full management control over ${displayName.toLowerCase()}`,\r\n      resource,\r\n      action: 'manage',\r\n      groupName,\r\n      sortOrder: 3,\r\n    })\r\n  }\r\n\r\n  if (options?.includeExport) {\r\n    permissions.push({\r\n      slug: `${resource}:export`,\r\n      name: `Export ${displayName}`,\r\n      description: `Export ${displayName.toLowerCase()} data`,\r\n      resource,\r\n      action: 'export',\r\n      groupName,\r\n      sortOrder: 4,\r\n    })\r\n  }\r\n\r\n  return permissions\r\n}\r\n\r\n// ============================================================================\r\n// DECORATORS (for class-based handlers)\r\n// ============================================================================\r\n\r\n/**\r\n * Method decorator to require permission\r\n * Usage: @RequirePermission('vehicles:read')\r\n */\r\nexport function RequirePermission(permission: Permission) {\r\n  return function (\r\n    _target: unknown,\r\n    _propertyKey: string,\r\n    descriptor: PropertyDescriptor\r\n  ) {\r\n    const originalMethod = descriptor.value\r\n    descriptor.value = function (this: { ctx?: TenantContext }, ...args: unknown[]) {\r\n      const ctx = this.ctx ?? (args[0] as TenantContext)\r\n      requirePermission(ctx, permission)\r\n      return originalMethod.apply(this, args)\r\n    }\r\n    return descriptor\r\n  }\r\n}\r\n\r\n/**\r\n * Method decorator to require minimum role\r\n * Usage: @RequireRole('admin')\r\n */\r\nexport function RequireRole(minimumRole: EntityRole) {\r\n  return function (\r\n    _target: unknown,\r\n    _propertyKey: string,\r\n    descriptor: PropertyDescriptor\r\n  ) {\r\n    const originalMethod = descriptor.value\r\n    descriptor.value = function (this: { ctx?: TenantContext }, ...args: unknown[]) {\r\n      const ctx = this.ctx ?? (args[0] as TenantContext)\r\n      requireRole(ctx, minimumRole)\r\n      return originalMethod.apply(this, args)\r\n    }\r\n    return descriptor\r\n  }\r\n}\r\n\r\n","// ============================================================================\r\n// APPHUB SDK - Scope Filtering Module (Data-Level Access Control)\r\n// ============================================================================\r\n\r\nimport type { TenantContext, ScopeValue, ScopeTypeDefinition } from './types'\r\n\r\n/**\r\n * Configuration for mapping scope types to database fields\r\n */\r\nexport interface ScopeFilterConfig {\r\n  /** Field name for single customer scope */\r\n  customer?: string\r\n  /** Field name for multiple customers scope */\r\n  customers?: string\r\n  /** Field name for region scope */\r\n  region?: string\r\n  /** Field name for entity IDs scope */\r\n  entityIds?: string\r\n  /** Field name for entity ID (required for all queries) */\r\n  entityId?: string\r\n  /** Custom field mappings for app-specific scopes */\r\n  custom?: Record<string, string>\r\n}\r\n\r\n/**\r\n * Apply scope filters to a Prisma-like where clause\r\n * Always includes entity filter for multi-tenancy\r\n * \r\n * @param where - Existing where clause\r\n * @param ctx - Tenant context with scope information\r\n * @param config - Field mapping configuration\r\n * @returns Updated where clause with scope filters\r\n */\r\nexport function applyScopeFilter<T extends Record<string, unknown>>(\r\n  where: T,\r\n  ctx: TenantContext,\r\n  config: ScopeFilterConfig = {}\r\n): T {\r\n  const result = { ...where }\r\n  const entityField = config.entityId ?? 'entityId'\r\n\r\n  // Always filter by entity\r\n  ;(result as Record<string, unknown>)[entityField] = ctx.entity.id\r\n\r\n  // No scope or full access - just entity filter\r\n  if (!ctx.scope || ctx.scope.type === 'full_access') {\r\n    return result\r\n  }\r\n\r\n  // Apply scope-specific filters\r\n  const scope = ctx.scope\r\n\r\n  switch (scope.type) {\r\n    case 'customer':\r\n      if (config.customer && scope.value?.customer_id) {\r\n        ;(result as Record<string, unknown>)[config.customer] = scope.value.customer_id\r\n      }\r\n      break\r\n\r\n    case 'customers':\r\n      if (config.customers && Array.isArray(scope.value?.customer_ids)) {\r\n        ;(result as Record<string, unknown>)[config.customers] = {\r\n          in: scope.value.customer_ids,\r\n        }\r\n      }\r\n      break\r\n\r\n    case 'region':\r\n      if (config.region && scope.value?.region) {\r\n        ;(result as Record<string, unknown>)[config.region] = scope.value.region\r\n      }\r\n      break\r\n\r\n    case 'entity_ids':\r\n      if (config.entityIds && Array.isArray(scope.value?.ids)) {\r\n        ;(result as Record<string, unknown>)[config.entityIds] = {\r\n          in: scope.value.ids,\r\n        }\r\n      }\r\n      break\r\n\r\n    default:\r\n      // Custom scope - apply all fields from value using custom mapping\r\n      if (scope.value && config.custom) {\r\n        for (const [scopeKey, dbField] of Object.entries(config.custom)) {\r\n          if (scopeKey in scope.value) {\r\n            const scopeValue = scope.value[scopeKey]\r\n            if (Array.isArray(scopeValue)) {\r\n              ;(result as Record<string, unknown>)[dbField] = { in: scopeValue }\r\n            } else {\r\n              ;(result as Record<string, unknown>)[dbField] = scopeValue\r\n            }\r\n          }\r\n        }\r\n      }\r\n  }\r\n\r\n  return result\r\n}\r\n\r\n/**\r\n * Create a scope filter function with pre-configured field mappings\r\n */\r\nexport function createScopeFilter(config: ScopeFilterConfig) {\r\n  return <T extends Record<string, unknown>>(where: T, ctx: TenantContext): T => {\r\n    return applyScopeFilter(where, ctx, config)\r\n  }\r\n}\r\n\r\n/**\r\n * Check if a user has access to a specific record based on scope\r\n */\r\nexport function hasAccessToRecord(\r\n  record: Record<string, unknown>,\r\n  ctx: TenantContext,\r\n  config: ScopeFilterConfig = {}\r\n): boolean {\r\n  const entityField = config.entityId ?? 'entityId'\r\n\r\n  // Check entity match\r\n  if (record[entityField] !== ctx.entity.id) {\r\n    return false\r\n  }\r\n\r\n  // No scope or full access - entity check is sufficient\r\n  if (!ctx.scope || ctx.scope.type === 'full_access') {\r\n    return true\r\n  }\r\n\r\n  const scope = ctx.scope\r\n\r\n  switch (scope.type) {\r\n    case 'customer':\r\n      if (config.customer && scope.value?.customer_id) {\r\n        return record[config.customer] === scope.value.customer_id\r\n      }\r\n      break\r\n\r\n    case 'customers':\r\n      if (config.customers && Array.isArray(scope.value?.customer_ids)) {\r\n        const value = record[config.customers]\r\n        return scope.value.customer_ids.includes(value as string)\r\n      }\r\n      break\r\n\r\n    case 'region':\r\n      if (config.region && scope.value?.region) {\r\n        return record[config.region] === scope.value.region\r\n      }\r\n      break\r\n\r\n    case 'entity_ids':\r\n      if (config.entityIds && Array.isArray(scope.value?.ids)) {\r\n        const value = record[config.entityIds]\r\n        return scope.value.ids.includes(value as string)\r\n      }\r\n      break\r\n\r\n    default:\r\n      // Custom scope - check all fields from custom mapping\r\n      if (scope.value && config.custom) {\r\n        for (const [scopeKey, dbField] of Object.entries(config.custom)) {\r\n          if (scopeKey in scope.value) {\r\n            const scopeValue = scope.value[scopeKey]\r\n            const recordValue = record[dbField]\r\n            if (Array.isArray(scopeValue)) {\r\n              if (!scopeValue.includes(recordValue as string)) {\r\n                return false\r\n              }\r\n            } else if (recordValue !== scopeValue) {\r\n              return false\r\n            }\r\n          }\r\n        }\r\n      }\r\n  }\r\n\r\n  return true\r\n}\r\n\r\n/**\r\n * Filter an array of records based on scope\r\n */\r\nexport function filterRecordsByScope<T extends Record<string, unknown>>(\r\n  records: T[],\r\n  ctx: TenantContext,\r\n  config: ScopeFilterConfig = {}\r\n): T[] {\r\n  return records.filter((record) => hasAccessToRecord(record, ctx, config))\r\n}\r\n\r\n/**\r\n * Guard function that throws if user doesn't have access to record\r\n */\r\nexport function requireAccessToRecord(\r\n  record: Record<string, unknown>,\r\n  ctx: TenantContext,\r\n  config: ScopeFilterConfig = {}\r\n): void {\r\n  if (!hasAccessToRecord(record, ctx, config)) {\r\n    throw new ScopeAccessError('Access denied to this record')\r\n  }\r\n}\r\n\r\n/**\r\n * Scope access error class\r\n */\r\nexport class ScopeAccessError extends Error {\r\n  code: string\r\n  \r\n  constructor(message: string) {\r\n    super(message)\r\n    this.name = 'ScopeAccessError'\r\n    this.code = 'scope_access_denied'\r\n  }\r\n}\r\n\r\n// ============================================================================\r\n// SCOPE TYPE DEFINITION HELPERS\r\n// ============================================================================\r\n\r\n/**\r\n * Define a full access scope type (no restrictions)\r\n */\r\nexport function defineFullAccessScope(): ScopeTypeDefinition {\r\n  return {\r\n    slug: 'full_access',\r\n    name: 'Full Access',\r\n    description: 'Access to all organization data without restrictions',\r\n    requiresSelection: false,\r\n    sortOrder: 0,\r\n  }\r\n}\r\n\r\n/**\r\n * Define a customer scope type\r\n */\r\nexport function defineCustomerScope(options?: {\r\n  name?: string\r\n  description?: string\r\n  multiSelect?: boolean\r\n  optionsEndpoint?: string\r\n}): ScopeTypeDefinition {\r\n  return {\r\n    slug: options?.multiSelect ? 'customers' : 'customer',\r\n    name: options?.name ?? (options?.multiSelect ? 'Customers' : 'Customer'),\r\n    description: options?.description ?? 'Limit access to specific customer(s)',\r\n    requiresSelection: true,\r\n    multiSelect: options?.multiSelect ?? false,\r\n    optionsEndpoint: options?.optionsEndpoint ?? '/api/v1/scope-options/customers',\r\n    sortOrder: 1,\r\n  }\r\n}\r\n\r\n/**\r\n * Define a region scope type\r\n */\r\nexport function defineRegionScope(options?: {\r\n  name?: string\r\n  description?: string\r\n  optionsEndpoint?: string\r\n}): ScopeTypeDefinition {\r\n  return {\r\n    slug: 'region',\r\n    name: options?.name ?? 'Region',\r\n    description: options?.description ?? 'Limit access to a geographic region',\r\n    requiresSelection: true,\r\n    multiSelect: false,\r\n    optionsEndpoint: options?.optionsEndpoint ?? '/api/v1/scope-options/regions',\r\n    sortOrder: 2,\r\n  }\r\n}\r\n\r\n/**\r\n * Define a custom scope type\r\n */\r\nexport function defineCustomScope(\r\n  slug: string,\r\n  options: Omit<ScopeTypeDefinition, 'slug'>\r\n): ScopeTypeDefinition {\r\n  return {\r\n    slug,\r\n    ...options,\r\n  }\r\n}\r\n\r\n// ============================================================================\r\n// UTILITY FUNCTIONS\r\n// ============================================================================\r\n\r\n/**\r\n * Get scope type from context\r\n */\r\nexport function getScopeType(ctx: TenantContext): string | null {\r\n  return ctx.scope?.type ?? null\r\n}\r\n\r\n/**\r\n * Get scope value from context\r\n */\r\nexport function getScopeValue<T = Record<string, unknown>>(\r\n  ctx: TenantContext\r\n): T | null {\r\n  return (ctx.scope?.value as T) ?? null\r\n}\r\n\r\n/**\r\n * Check if context has full access (no scope restrictions)\r\n */\r\nexport function hasFullAccess(ctx: TenantContext): boolean {\r\n  return !ctx.scope || ctx.scope.type === 'full_access'\r\n}\r\n\r\n/**\r\n * Check if context has a specific scope type\r\n */\r\nexport function hasScopeType(ctx: TenantContext, scopeType: string): boolean {\r\n  return ctx.scope?.type === scopeType\r\n}\r\n\r\n/**\r\n * Build scope options response for AppHub\r\n */\r\nexport interface ScopeOptionItem {\r\n  id: string\r\n  name: string\r\n  meta?: Record<string, unknown>\r\n}\r\n\r\nexport function buildScopeOptionsResponse(items: ScopeOptionItem[]): {\r\n  data: ScopeOptionItem[]\r\n} {\r\n  return { data: items }\r\n}\r\n\r\n","// ============================================================================\r\n// APPHUB SDK - Main Entry Point\r\n// ============================================================================\r\n\r\n/**\r\n * @apphub/sdk\r\n * \r\n * Official SDK for integrating applications with AppHub authentication\r\n * and authorization system.\r\n * \r\n * ## Quick Start\r\n * \r\n * ```typescript\r\n * import { createAppHubClient } from '@apphub/sdk'\r\n * \r\n * const apphub = createAppHubClient({\r\n *   hubUrl: process.env.APPHUB_URL!,\r\n *   clientId: process.env.APPHUB_CLIENT_ID!,\r\n *   clientSecret: process.env.APPHUB_CLIENT_SECRET!,\r\n *   appSlug: 'myapp',\r\n * })\r\n * \r\n * // Validate token and get context\r\n * const ctx = await apphub.jwt.getTenantContext(token)\r\n * \r\n * // Check permissions\r\n * if (hasPermission(ctx, 'vehicles:read')) {\r\n *   // ...\r\n * }\r\n * ```\r\n * \r\n * ## Framework-Specific Imports\r\n * \r\n * ```typescript\r\n * // Next.js with NextAuth.js\r\n * import { createAppHubProvider } from '@apphub/sdk/nextjs'\r\n * \r\n * // React client utilities\r\n * import { hasPermission, hasRole } from '@apphub/sdk/react'\r\n * ```\r\n */\r\n\r\nimport type { AppHubConfig } from './types'\r\nimport { AppHubOAuth, createOAuthClient } from './oauth'\r\nimport { AppHubJWT, createJWTValidator } from './jwt'\r\nimport { AppHubApiClient, createApiClient } from './api'\r\nimport { WebhookProcessor, createWebhookProcessor } from './webhook'\r\n\r\n// ============================================================================\r\n// TYPES\r\n// ============================================================================\r\n\r\nexport type {\r\n  // Configuration\r\n  AppHubConfig,\r\n  \r\n  // User & Authentication\r\n  AppHubUser,\r\n  AppHubEntity,\r\n  EntityRole,\r\n  SystemRole,\r\n  \r\n  // Scopes & Permissions\r\n  ScopeValue,\r\n  Permission,\r\n  PermissionAction,\r\n  PermissionDefinition,\r\n  ScopeTypeDefinition,\r\n  \r\n  // JWT Token\r\n  AppHubTokenPayload,\r\n  \r\n  // Tenant Context\r\n  TenantContext,\r\n  \r\n  // OAuth\r\n  AuthorizationParams,\r\n  TokenResponse,\r\n  OAuthError,\r\n  \r\n  // Webhooks\r\n  WebhookEventType,\r\n  WebhookEvent,\r\n  WebhookActor,\r\n  UserEventData,\r\n  MembershipEventData,\r\n  LicenseEventData,\r\n  \r\n  // API\r\n  ApiResponse,\r\n  ApiError,\r\n  ScopeOption,\r\n  License,\r\n  LicenseStatus,\r\n  Plan,\r\n  App,\r\n  AppStatus,\r\n} from './types'\r\n\r\n// ============================================================================\r\n// OAUTH\r\n// ============================================================================\r\n\r\nexport {\r\n  AppHubOAuth,\r\n  AppHubOAuthError,\r\n  createOAuthClient,\r\n} from './oauth'\r\n\r\n// ============================================================================\r\n// JWT\r\n// ============================================================================\r\n\r\nexport {\r\n  AppHubJWT,\r\n  AppHubJWTError,\r\n  createJWTValidator,\r\n  extractBearerToken,\r\n  extractTokenFromRequest,\r\n} from './jwt'\r\n\r\nexport type { JWTValidationOptions, JWTValidationResult } from './jwt'\r\n\r\n// ============================================================================\r\n// RBAC\r\n// ============================================================================\r\n\r\nexport {\r\n  // Permission checks\r\n  hasPermission,\r\n  hasAllPermissions,\r\n  hasAnyPermission,\r\n  hasRole,\r\n  hasExactRole,\r\n  isOwner,\r\n  isAdmin,\r\n  isImpersonated,\r\n  \r\n  // Resource helpers\r\n  parsePermission,\r\n  buildPermission,\r\n  getPermissionsForResource,\r\n  canPerform,\r\n  canRead,\r\n  canWrite,\r\n  canDelete,\r\n  canManage,\r\n  \r\n  // Guards\r\n  requirePermission,\r\n  requireAllPermissions,\r\n  requireAnyPermission,\r\n  requireRole,\r\n  requireAdmin,\r\n  requireOwner,\r\n  AuthorizationError,\r\n  \r\n  // Definition helpers\r\n  definePermission,\r\n  defineCrudPermissions,\r\n  \r\n  // Decorators\r\n  RequirePermission,\r\n  RequireRole,\r\n} from './rbac'\r\n\r\n// ============================================================================\r\n// SCOPE\r\n// ============================================================================\r\n\r\nexport {\r\n  // Filtering\r\n  applyScopeFilter,\r\n  createScopeFilter,\r\n  hasAccessToRecord,\r\n  filterRecordsByScope,\r\n  requireAccessToRecord,\r\n  ScopeAccessError,\r\n  \r\n  // Scope definition helpers\r\n  defineFullAccessScope,\r\n  defineCustomerScope,\r\n  defineRegionScope,\r\n  defineCustomScope,\r\n  \r\n  // Utilities\r\n  getScopeType,\r\n  getScopeValue,\r\n  hasFullAccess,\r\n  hasScopeType,\r\n  buildScopeOptionsResponse,\r\n} from './scope'\r\n\r\nexport type { ScopeFilterConfig, ScopeOptionItem } from './scope'\r\n\r\n// ============================================================================\r\n// WEBHOOK\r\n// ============================================================================\r\n\r\nexport {\r\n  verifyWebhookSignature,\r\n  parseWebhookRequest,\r\n  WebhookProcessor,\r\n  WebhookError,\r\n  createWebhookProcessor,\r\n  createNextJSWebhookHandler,\r\n} from './webhook'\r\n\r\nexport type { WebhookHandler, WebhookHandlerMap, NextJSWebhookOptions } from './webhook'\r\n\r\n// ============================================================================\r\n// API CLIENT\r\n// ============================================================================\r\n\r\nexport {\r\n  AppHubApiClient,\r\n  AppHubApiError,\r\n  createApiClient,\r\n} from './api'\r\n\r\n// ============================================================================\r\n// MAIN CLIENT\r\n// ============================================================================\r\n\r\n/**\r\n * Complete AppHub client with all modules\r\n */\r\nexport interface AppHubClient {\r\n  /** OAuth authentication client */\r\n  oauth: AppHubOAuth\r\n  /** JWT token validator */\r\n  jwt: AppHubJWT\r\n  /** API client for AppHub endpoints */\r\n  api: AppHubApiClient\r\n  /** Webhook processor (only if webhookSecret provided) */\r\n  webhooks?: WebhookProcessor\r\n  /** SDK configuration */\r\n  config: AppHubConfig\r\n}\r\n\r\n/**\r\n * Create a complete AppHub client\r\n * \r\n * @example\r\n * ```typescript\r\n * const apphub = createAppHubClient({\r\n *   hubUrl: 'https://hub.example.com',\r\n *   clientId: 'myapp_client_123',\r\n *   clientSecret: 'secret_xyz',\r\n *   appSlug: 'myapp',\r\n *   webhookSecret: 'whsec_abc',\r\n * })\r\n * \r\n * // OAuth flow\r\n * const { authorizationUrl, codeVerifier, state } = \r\n *   await apphub.oauth.createAuthorizationUrl({\r\n *     redirectUri: 'https://myapp.com/callback'\r\n *   })\r\n * \r\n * // Validate tokens\r\n * const ctx = await apphub.jwt.getTenantContext(accessToken)\r\n * \r\n * // Register permissions\r\n * await apphub.api.syncPermissions([\r\n *   { slug: 'items:read', name: 'View Items', ... }\r\n * ])\r\n * \r\n * // Handle webhooks\r\n * apphub.webhooks?.onUserCreated(async (event) => {\r\n *   console.log('New user:', event.data)\r\n * })\r\n * ```\r\n */\r\nexport function createAppHubClient(config: AppHubConfig): AppHubClient {\r\n  const client: AppHubClient = {\r\n    oauth: createOAuthClient(config),\r\n    jwt: createJWTValidator(config),\r\n    api: createApiClient(config),\r\n    config,\r\n  }\r\n\r\n  if (config.webhookSecret) {\r\n    client.webhooks = createWebhookProcessor(config.webhookSecret)\r\n  }\r\n\r\n  return client\r\n}\r\n\r\n// ============================================================================\r\n// VERSION\r\n// ============================================================================\r\n\r\nexport const SDK_VERSION = '1.0.0'\r\n\r\n// ============================================================================\r\n// DEFAULT EXPORT\r\n// ============================================================================\r\n\r\nexport default createAppHubClient\r\n\r\n"]}